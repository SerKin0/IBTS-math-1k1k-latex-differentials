\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{bookstyle}[2025/06/22 Пакет с настройками для дипломной работы]

% ======================= ПОДКЛЮЧЕНИЕ ПАКЕТОВ ==============================
%% Библиография
\RequirePackage[backend=biber,style=gost-numeric,sorting=nty]{biblatex}

%% Настройки страниц
\RequirePackage{geometry} % Настройки полей и страницы

%% Программирование
\RequirePackage{listings}

%% Настройки текста/языка
\RequirePackage{extsizes}
\RequirePackage{iftex} % Добавляем пакет для проверки движка

% Разные настройки для pdflatex и xelatex
\RequirePackage[T2A]{fontenc}
\RequirePackage[utf8]{inputenc}
\RequirePackage[english,russian]{babel}
\RequirePackage{cmap}
% \RequirePackage{tempora}

\RequirePackage{indentfirst} % Красная строка
\RequirePackage{setspace} % Межстрочный интервал
\RequirePackage{ulem} % Подчеркивания
\RequirePackage{enumitem}
\RequirePackage{titlesec} % Настройка заголовков (section, subsection,...)
\RequirePackage{tocloft} % Содержание
\RequirePackage{fancyhdr} % Колонтитулы
\RequirePackage{abraces} % Фигурные скобки
\RequirePackage{multicol} % Колонки
\RequirePackage{multirow}    % Для объединения строк (\multirow)

%% Объекты
\RequirePackage{graphicx,placeins} % Фотографии
\RequirePackage{wrapfig}
\RequirePackage{float}    % Для позиционирования объектов
\RequirePackage[tableposition=top]{caption} % Для настройки подписей
\RequirePackage{subcaption}  % Пакет для создания подписей к подрисункам
\RequirePackage{tabularx, tabulary}
\RequirePackage{tikz}
\RequirePackage{tcolorbox} % Стильные боксы
\RequirePackage{draftwatermark}
\RequirePackage{xfrac}

%% Математика
\RequirePackage{amsmath, amssymb, amsfonts, mathtools} % Пакеты для математики AMS
\RequirePackage{icomma} % "Умная" запятая: $0,2$ --- число, $0, 2$ --- перечисление

%% Ссылки
\RequirePackage{cmap} % Для более качественного поиска по pdf и т.п.
\RequirePackage{xurl} % Позволяет переносить URL где угодно
\RequirePackage[colorlinks,breaklinks,hypertexnames=false]{hyperref} % Ссылки внутри документа
\RequirePackage[russian,capitalize]{cleveref} % Удобные сноски на элементы

%% Разное
\RequirePackage[table]{xcolor}


% ======================== НАСТРОЙКИ ПАКЕТОВ ===============================
% Настройка РАЗМЕРОВ geometry
\geometry{
	a5paper,
	left=1cm,
	right=1cm,
	top=1.5cm,
	bottom=1.5cm,
	headheight=14pt,  % минимальная высота колонтитула
	headsep=8pt       % расстояние между колонтитулом и текстом
}

\makeatletter
\def\@evenfoot{\hfil Страница \thepage \hfil} % Для четных страниц
\def\@oddfoot{\hfil Страница \thepage \hfil}  % Для нечетных страниц
\makeatother

%% Настройка ССЫЛОК
\hypersetup{
	colorlinks=true,  % Включает цветные ссылки (false — рамки вокруг текста)
	linkcolor=black,  % Цвет ссылок в оглавлении (на разделы)
	urlcolor=black,   % Цвет URL-адресов
	citecolor=black,  % Цвет ссылок на библиографию
}

%% Установка шрифта документа
% Абзацные ОТСТУПЫ и ИНТЕРВАЛЫ
\setlength{\parindent}{1.5em} % Абзацный отступ
\setlength{\parskip}{0.em} % Интервал между абзацами
%\linespread{1.3} % 1.5 межстрочный интервал

% Настройки описания у ФОТОГРАФИЙ
\captionsetup[figure]{
	labelsep=period, % Точка после "Рис. X"
	name={Рис.},     % Заменяем "Figure" на "Рис."
	justification=centering % Выравнивание по центру
}

% Настройки изображений
% \graphicspath{{./image/}} % Директория папки с фотографиями


% Настройки описания у ТАБЛИЦ
\captionsetup[table]{
	name={Таблица},       % название будет "Таблица" вместо "Table"
	labelsep=period,      % точка после номера
	justification=raggedleft,  % выравнивание по левому краю
	singlelinecheck=false,       % не центрировать, даже если подпись короткая
	position=top,         % подпись будет сверху таблицы
	skip=0pt,              % расстояние между подписью и таблицей
	width=0.9\textwidth
}

% Настройки для CLEVEREF
\crefname{figure}{рис.}{рис.} % Для рисунков
\Crefname{figure}{Рис.}{Рис.}

\crefname{table}{табл.}{табл.} % Для таблиц
\Crefname{table}{Табл.}{Табл.} % Для таблиц

\crefname{appsection}{прил.}{прил.} % Для приложений
\Crefname{appsection}{Прил.}{Прил.} % Для приложений

\crefname{listing}{лист.}{лист.} % Для листингов
\Crefname{listing}{Лист.}{Лист.} % Для листингов

\crefname{equation}{}{(} % Убираем "Уравнение" и добавляем "("
\crefformat{equation}{(#2#1#3)} % Одиночная ссылка: (1)
\crefrangelabelformat{equation}{(#3#1#4--#5#2#6)} % Диапазон: (4--7)
\crefmultiformat{equation}{(#2#1#3)}{ и~(#2#1#3)}{, (#2#1#3)}{ и~(#2#1#3)} % Список: (1), (2) и (3)



%% ПРОГРАММИРОВАНИЕ (listings)
% Определение тёмно-зелёного цвета (можно настроить оттенок)
\definecolor{darkgreen}{rgb}{0.0, 0.6, 0.0}
\definecolor{pycharm-keyword}{RGB}{200, 0, 110}      % Ключевые слова
\definecolor{pycharm-string}{RGB}{42, 0, 255}       % Строки
\definecolor{pycharm-comment}{RGB}{128, 128, 128}   % Комментарии
\definecolor{pycharm-number}{RGB}{0, 0, 255}        % Числа
\definecolor{pycharm-background}{RGB}{255, 255, 255}% Фон
\definecolor{pycharm-frame}{RGB}{214, 214, 214}     % Рамка
\definecolor{pycharm-identifier}{RGB}{0, 0, 0}      % Идентификаторы

\lstset{
	showtabs = false,
	basicstyle = \small\ttfamily,
	breaklines = true,
	breakatwhitespace = false,
	prebreak = \mbox{\textcolor{red}{$\hookleftarrow$}},
	postbreak = \mbox{\textcolor{red}{$\hookrightarrow$}},
	breakindent = 5pt,
	breakautoindent = true,
	numbers = left,
	numberstyle = \footnotesize\color{gray},
	numbersep = 5pt,
	stepnumber = 1,
	firstnumber = 1,
	frame = single,
	xleftmargin = 3pt,
	xrightmargin = 3pt,
	rulecolor = \color{lightgray},
	backgroundcolor = \color{white},
	keywordstyle = \color{blue}\bfseries,
	commentstyle = \color{darkgreen}\itshape,
	stringstyle = \color{red},
	morecomment = [s][\color{purple}]{/**}{*/},
	morecomment = [s][commentstyle]{/*}{*/},
	morecomment = [l][commentstyle]{//},
	columns = fullflexible,
	showstringspaces = false, % Подчеркивание пробелов в строках
	keepspaces = true,
	tabsize = 4,
	captionpos = top,
	inputencoding = utf8x,
	extendedchars = true,
	literate =
	{а}{{\cyra}}1 {б}{{\cyrb}}1 {в}{{\cyrv}}1 {г}{{\cyrg}}1 {д}{{\cyrd}}1
	{е}{{\cyre}}1 {ё}{{\cyryo}}1 {ж}{{\cyrzh}}1 {з}{{\cyrz}}1 {и}{{\cyri}}1
	{й}{{\cyrishrt}}1 {к}{{\cyrk}}1 {л}{{\cyrl}}1 {м}{{\cyrm}}1 {н}{{\cyrn}}1
	{о}{{\cyro}}1 {п}{{\cyrp}}1 {р}{{\cyrr}}1 {с}{{\cyrs}}1 {т}{{\cyrt}}1
	{у}{{\cyru}}1 {ф}{{\cyrf}}1 {х}{{\cyrh}}1 {ц}{{\cyrc}}1 {ч}{{\cyrch}}1
	{ш}{{\cyrsh}}1 {щ}{{\cyrshch}}1 {ъ}{{\cyrhrdsn}}1 {ы}{{\cyrery}}1
	{ь}{{\cyrsftsn}}1 {э}{{\cyrerev}}1 {ю}{{\cyryu}}1 {я}{{\cyrya}}1
	{А}{{\CYRA}}1 {Б}{{\CYRB}}1 {В}{{\CYRV}}1 {Г}{{\CYRG}}1 {Д}{{\CYRD}}1
	{Е}{{\CYRE}}1 {Ё}{{\CYRYO}}1 {Ж}{{\CYRZH}}1 {З}{{\CYRZ}}1 {И}{{\CYRI}}1
	{Й}{{\CYRISHRT}}1 {К}{{\CYRK}}1 {Л}{{\CYRL}}1 {М}{{\CYRM}}1 {Н}{{\CYRN}}1
	{О}{{\CYRO}}1 {П}{{\CYRP}}1 {Р}{{\CYRR}}1 {С}{{\CYRS}}1 {Т}{{\CYRT}}1
	{У}{{\CYRU}}1 {Ф}{{\CYRF}}1 {Х}{{\CYRH}}1 {Ц}{{\CYRC}}1 {Ч}{{\CYRCH}}1
	{Ш}{{\CYRSH}}1 {Щ}{{\CYRSHCH}}1 {Ъ}{{\CYRHRDSN}}1 {Ы}{{\CYRERY}}1
	{Ь}{{\CYRSFTSN}}1 {Э}{{\CYREREV}}1 {Ю}{{\CYRYU}}1 {Я}{{\CYRYA}}1
	{-}{{-}}1
}
\DeclareCaptionFormat{listing}{\centering~#1 --- #3}
\captionsetup[lstlisting]{format=listing, singlelinecheck=off}


%% Настройка ЗАГОЛОВКОВ
\titleformat{\section}[block]{\Large\bfseries\centering}{\Roman{section}.}{0.5em}{\MakeUppercase}[]
\titleformat{\subsection}[block]{\large\bfseries\centering}{\arabic{subsection}.}{0.5em}{}[]
\titleformat{\subsubsection}[block]{\centering\bfseries}{}{0.5em}{}[]

% Заголовок для Приложения(appendix)
% Создаём новый счётчик для приложений
\newcounter{appsection}
\renewcommand{\theappsection}{\arabic{appsection}}

% Команда для заголовка приложения
\newcommand{\appendixsection}[1]{
	\refstepcounter{appsection}
	\vspace{1em}
	\noindent{\largeПриложение \theappsection. #1}
	\par\nopagebreak
	\addcontentsline{toc}{subsection}{Приложение \theappsection. #1}  % Добавляем в оглавление
	\label{app:#1}  % Автоматическая метка (можно заменить на ручные \label)
}

%% Настройка отступов ПЕРЕЧИСЛЕНИЙ
\renewcommand{\thesubfigure}{\asbuk{subfigure}} % Для кириллических букв

\setlist[enumerate,2]{label=\asbuk*)} % Устанавливает формат для второго уровня
\renewcommand\labelitemi{{\Large$\cdot$}} % Установка размера точки в itemize

\makeatletter
\AddEnumerateCounter{\asbuk}{\russian@alph}{щ}
\makeatother

%% Настройки ЛИТЕРАТУРЫ biblatex
% \addbibresource{BibTeX/references.bib}
% Убрано из пакета, так как путь может отличаться в разных документах

%% Настройка СОДЕРЖАНИЯ
\setlength{\cftbeforesecskip}{0.25em} % Уменьшает расстояние между пунктами
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}} % Автоматические точки
\renewcommand{\contentsname}{Оглавление}

\renewcommand{\thesubsubsection}{} % Пустой номер
\renewcommand{\cftsubsubsecpresnum}{} % Убираем префикс
\setlength{\cftsubsubsecnumwidth}{0pt} % Обнуляем ширину поля номера
\setlength{\cftsubsubsecindent}{4.5em} % Отступ для выравнивания с нумерованными

%% Переносы текста
\sloppy % Старается впихнуть в строку текст, ссылки и т.п.

% МАТЕМАТИКА
%% Перенос знаков в формулах (по Львовскому)
\newcommand*{\hm}[1]{#1\nobreak\discretionary{}
	{\hbox{$\mathsurround=0pt #1$}}{}}
% Настройка отступов вокруг формул в выключном стиле (displaymath)
\abovedisplayskip = 0.5em % Отступ сверху для обычных формул
\belowdisplayskip = 0.5em % Отступ снизу для обычных формул
\abovedisplayshortskip = 0em % Отступ сверху, если строка перед формулой короткая
\belowdisplayshortskip= 0em % Отступ снизу, если строка после формулы короткая

\numberwithin{equation}{subsection} % Привязываем к подразделу
\numberwithin{subsection}{section}  % Чтобы subsection учитывал section

\DeclareMathOperator{\grad}{grad}
\DeclareMathOperator{\N}{\mathbb{N}}
\DeclareMathOperator{\R}{\mathbb{R}}
\DeclareMathOperator{\E}{\mathbb{E}}

\DeclareMathOperator{\Real}{Re} % Создает команду \Real
\DeclareMathOperator{\Imag}{Im} % Создает команду \Real


\newcommand{\sumzerotoinf}{\sum\limits_{n=0}^{\infty}}
\newcommand{\sumonetoinf}{\sum\limits_{n=1}^{\infty}}

\newcommand{\nsum}[2]{\sum\limits_{n = #1}^{#2}}
\newcommand{\lint}[2]{\int\limits_{#1}^{#2}}

\newcommand{\dd}[2]{\frac{d #1}{d #2}}
\newcommand{\pp}[2]{\frac{\partial #1}{\partial #2}}

\newcommand{\ddd}[2]{\displaystyle\dd{#1}{#2}}
\newcommand{\dpp}[2]{\displaystyle\pp{#1}{#2}}

\newcommand{\tdd}[2]{\textstyle\dd{#1}{#2}}
\newcommand{\tpp}[2]{\textstyle\pp{#1}{#2}}


\setlist[enumerate]{
	noitemsep,      % Убирает лишние отступы между пунктами
	topsep=0.2em,     % Отступ сверху списка
	parsep=0pt,     % Отступ между абзацами внутри пункта
	partopsep=0pt,   % Доп. отступ, если список начинается после пустой строки
	itemsep=0.2em,     % Расстояние между пунктами (можно задать вручную, например, 1pt)
}

\setlist[itemize]{
	noitemsep,      % Убирает лишние отступы между пунктами
	topsep=0.2em,     % Отступ сверху списка
	parsep=0pt,     % Отступ между абзацами внутри пункта
	partopsep=0pt,   % Доп. отступ, если список начинается после пустой строки
	itemsep=0.2em,     % Расстояние между пунктами (можно задать вручную, например, 1pt)
}

\tcbuselibrary{skins, breakable}  % <-- Добавьте эту строку!
% Блоки определений
\newtcolorbox{tbox}[2][]{
	colback=white!98!black,
	colframe=white!80!black,
	fonttitle=\bfseries,
	coltitle=black,
	title={#2},
	before upper={\setlength{\parindent}{15pt}},
	left=3pt,  % Отступ слева от рамки до внешнего контента
	right=3pt, % Отступ справа от рамки до внешнего контента
	boxsep=2pt, % Отступ от рамки до содержимого
	breakable,       % Оставляем, если нужны разрывы
	standard,        % Вместо enhanced → быстрее
	before={\addcontentsline{toc}{subsubsection}{#2}}
}
\newtcolorbox{tbox*}[2][]{
	colback=white!98!black,
	colframe=white!80!black,
	fonttitle=\bfseries,
	coltitle=black,
	title={#2},
	before upper={\setlength{\parindent}{15pt}},
	left=3pt,  % Отступ слева от рамки до внешнего контента
	right=3pt, % Отступ справа от рамки до внешнего контента
	boxsep=2pt, % Отступ от рамки до содержимого
	breakable,       % Оставляем, если нужны разрывы
	standard,        % Вместо enhanced → быстрее
}

\newtcolorbox{librarybox}{
	enhanced,
	colback=gray!10, % светло-серый фон
	boxrule=0pt, % убираем рамку
	arc=0pt, % убираем скругление углов
	outer arc=0pt,
	left=6pt, % отступ текста от линий
	right=4pt,
	top=4pt,
	bottom=4pt,
	before skip=12pt, % отступ перед box
	after skip=12pt, % отступ после box
	overlay={
		% Первая линия (толстая серая)
		\draw[gray!50, line width=4pt]
		(frame.south west) -- (frame.north west);
		% Вторая линия (тонкая темная)
		\draw[gray!50, line width=1pt]
		([xshift=4pt]frame.south west) -- ([xshift=4pt]frame.north west);
	}
}


\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\begin{minipage}[t]{0.55\textwidth}\flushright\small\itshape\rightmark\end{minipage}}
\fancyfoot[L]{\begin{minipage}[t]{0.55\textwidth}\small\itshape Скороходов С. А.\end{minipage}}
\fancyhead[L]{\begin{minipage}[t]{0.55\textwidth}\small\itshape Комплексные числа\end{minipage}}
\fancyfoot[C]{\small Страница \thepage}

% Просто копируем настройки для plain
\makeatletter
\let\ps@plain\ps@fancy

% Настраиваем rightmark для отображения названия подраздела
\renewcommand{\sectionmark}[1]{\markright{\MakeUppercase{#1}}} % Устанавливаем метку для раздела
\renewcommand{\subsectionmark}[1]{\markright{\thesubsection\ #1}} % Устанавливаем метку для подраздела

% Переопределяем стиль страницы для оглавления
\let\oldtoc\tableofcontents
\renewcommand{\tableofcontents}{\thispagestyle{fancy}\oldtoc}

\SetWatermarkFontSize{10pt}  % Explicitly set reasonable size
\SetWatermarkScale{2.5}
\SetWatermarkLightness{0.9}
\SetWatermarkText{\textbf{Скороходов Сергей Александрович}}

\frenchspacing
\endinput